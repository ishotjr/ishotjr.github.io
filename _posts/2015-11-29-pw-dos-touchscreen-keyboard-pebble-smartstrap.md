---
layout: post
title: "PW-DOS Keyboard Smartstrap"
date:   2015-11-29 19:21:42
# categories: 
---

When Pebble [announced the new Pebble Time smartstrap functionality](https://www.kickstarter.com/projects/597507018/pebble-time-awesome-smartwatch-no-compromises/posts/1151421) during their Kickstarter campaign, I remember being intrigued by the possibility of hardware add-ons, but it seemed like something distant at the time.  When the [Hardware specification](https://developer.getpebble.com/guides/hardware/smartstrap-hardware/) was published, however, I realized that this was something that could be hacked on, rather than just a protocol for big 3rd party manufacturers to leverage.  I started spending all of my available time [hacking on smartstraps - even before the firmware to support them was released](https://twitter.com/IShJR/status/635320276142686209), and modified the initially Teensy-focused [serial library](https://github.com/pebble/ArduinoPebbleSerial) to work on the Arduinos I had at hand, eventually resulting in [a working smartstrap once the firmware was released](https://twitter.com/IShJR/status/637835062579494912)!  Next up was the [charging cable hack](https://twitter.com/IShJR/status/638181644566949893) once it became clear that the 3d-printed connector, which lacked magnets, was not even close to being stable enough to maintain a connection.  And then I had the chance (of a life time!) to participate in Pebble's smartstrap hackathon, [Pebble Rocks Boulder](http://pebblerocksboulder.com/)!

Hot off of [a win](https://www.hackster.io/hackathons/pebble-rocks-boulder/a-pebble-hackathon/projects) with our [Team Hack Dads Pebble Altimeter Smartstrap](https://github.com/HackDads/PebbleRocksBoulder/wiki), I became consumed with enthusiasm for the platform.  Inspired by [Matt Hungerford](https://github.com/mhungerford)'s demonstration of the Pebble Time's frame buffer being transmitted to an external display, I set out to do similar using the [Gameduino 2](http://excamera.com/sphinx/gameduino2/) that I already had, but got distracted by the Gameduino's touchscreen and widget capabilities and decided it would be more fun to use it as an input, the most exciting (and ridiculous!) form of which that occurred to me at the time being [a keyboard](https://github.com/ishotjr/PebMega-Smartstrap/tree/kb) input for the Pebble Time!

By far the biggest issue encountered during development so far was difficultly successfully transmitting a 32-bit epoch time value from the Pebble Time to the Arduino (the latter lacks an RTC so leveraging the Pebble to help the Arduino tell time seemed like a fun exercise at the time!) since despite [both](https://pebbledev.slack.com/archives/pebble/p1448167892002972) systems being [confirmed little-endian](http://forum.arduino.cc/index.php?topic=41272.0), the 32-bit integer was behaving as though its most significant 16 bits had been lopped off on arrival.  Unpacking the byte array by hand and combining (after appropriately shifting) the results provided a fix for now, though I plan to explore assurances from the Pebble team that just casting (i.e. `*(uint32_t *)buffer`) should work just as well (keep an eye on my [Pro Pebble Development](http://ishotjr.github.io/pro-pebble-dev/) blog for a more detailed analysis?).

The result of my experiments with adding an external touchscreen to the Pebble Time are encapsulated in the video demonstration below, where a hacked watchapp version of my [PW-DOS Command Line Watchface for Pebble](https://apps.getpebble.com/applications/550f2f3a46cb79c9bc000044) receives keyboard input and emulates the DOS `DIR` command.  [Source](https://github.com/ishotjr/PebMega-Smartstrap/tree/kb) for [each](https://github.com/ishotjr/pw-dos/tree/kb) is available, but in desperate need of clean-up - being presently hacked however was required to allow the below video demonstration to be achieved - but will be refining and expanding as time allows!

Shout out to the [Engineerable](https://twitter.com/Engineerable) team whose [TimeDock](http://www.thatthingyoulove.com/products/timedock-charging-dock-for-pebble-time-and-pebble-time-steel) is the only elegant part of the video! :D

<iframe width="560" height="315" src="https://www.youtube.com/embed/qPhGKKiJ6hQ?rel=0&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>